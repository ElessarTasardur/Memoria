\documentclass[12pt, a4paper, twoside, titlepage]{book}

% Paquetes usados

\usepackage{fancyhdr}
\usepackage[a4paper, top=4cm, bottom=4cm, left=3.3cm, right=3.2cm, headheight=16pt]{geometry}
\usepackage[dvips,pdftex]{graphicx}
\usepackage{subfigure}
\usepackage{booktabs}
\usepackage{url}
\usepackage{xcolor}   %May be necessary if you want to color links
\definecolor{pblue}{rgb}{0.13,0.13,1}
\definecolor{pgreen}{rgb}{0,0.5,0}
\definecolor{pred}{rgb}{0.9,0,0}
\definecolor{pgrey}{rgb}{0.46,0.45,0.48}
\usepackage{listings}
\lstset{
	language=Java,
  showspaces=false,
  showtabs=false,
  breaklines=true,
  showstringspaces=false,
  breakatwhitespace=true,
	frame=single,
  commentstyle=\color{pgreen},
  keywordstyle=\color{pblue},
  stringstyle=\color{pred},
  basicstyle=\ttfamily,
  moredelim=[is][\color{pgrey}]{$$}{$$},
	basicstyle=\footnotesize\setstretch{1.2}
}
\lstdefinelanguage{XML}
{
  morestring=[b]",
  morestring=[s]{>}{<},
  morecomment=[s]{<?}{?>},
  stringstyle=\color{black},
  identifierstyle=\color{pgreen},
  keywordstyle=\color{pblue},
  stringstyle=\color{pred},
  morekeywords={android}
}

\usepackage{eurosym}

\usepackage[draft]{todonotes}  %% CVR  draft/disable (borrador/definitivo)
%\todo[inline]{comment}  %% CVR, para poner un comentario, [inline] es opcional
%\listoftodos %% CVR, para mostrar todos los comentarios
%\missingfigure{Add my picture here.}

\usepackage{appendix} %%% CVR !?!?


%\usepackage[latin1]{inputenc} %% CV
\usepackage[utf8]{inputenc}  %% CVR
%\usepackage[spanish]{babel} %% CVR
\usepackage[spanish,activeacute]{babel} %% CVR
\addto\extrasspanish{%
  \renewcommand{\figureautorefname}{Figura}%
  \renewcommand{\tableautorefname}{Tabla}%
  \renewcommand{\lstlistingname}{Código}%
  \renewcommand{\lstlistlistingname}{Índice de códigos}%
}
\usepackage{float}

\usepackage{titlesec}
\usepackage{setspace}

\usepackage{multirow}
\usepackage{tabularx}
\newcommand{\tabitem}{~~\llap{\textbullet}~~}


\usepackage{hyperref}
\hypersetup{
    colorlinks=true, %set true if you want colored links
    linktoc=all,     %set to all if you want both sections and subsections linked
    linkcolor=blue,  %choose some color if you want links to stand out
}


% Aumentar la separación entre líneas
\renewcommand{\baselinestretch}{1.5}


% Para eliminar la cabecera de las páginas vacías al final de los
% capítulos
\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
  \hbox{}
    \thispagestyle{empty}
      \newpage
        \if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother
%%

% Cabeceras capítulos alineadas a la derecha
% \titleformat{<command>}[<shape>]{<format>}{<label>}{<sep>}{<before-code>}[<after-code>]
\titleformat{\chapter}[display]
  {\normalfont\Large\bfseries\raggedleft}{\chaptertitlename\ \thechapter}{20pt}{\Huge\setstretch{0.8}}
\titleformat{\section}
	{\normalfont\Large\bfseries}{\thesection}{1em}{}


\begin{document}


\pagestyle{empty}

\include{portada}
\cleardoublepage

% Numeración romana de páginas
\pagenumbering{roman}


% Dedicatoria y agradecimientos
\include{agradecimientos-resumen}


% Resumen y palabras clave
%\include{resumen}
%\cleardoublepage

% Definimos el encabezado y pie de página
\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{%
\markboth{\thechapter.\ #1}{}}
\renewcommand{\sectionmark}[1]{%
\markright{\thesection.\ #1}{}}
\fancyhead{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[LO,ER]{\rightmark}
\fancyfoot{}


% Índice de capítulos, secciones y subsecciones
\cleardoublepage
\pdfbookmark[0]{\contentsname}{toc}%
\tableofcontents

% Índice de figuras
\cleardoublepage
\phantomsection \label{listoffigures}
\addcontentsline{toc}{chapter}{\listfigurename}
\listoffigures


% Redefinición del nombre que encabeza las tablas. Por defecto es cuadro.
\renewcommand\tablename{Tabla}
\renewcommand\listtablename{Índice de tablas}

% Índice de tablas 
\cleardoublepage
\phantomsection \label{listoftables}
\addcontentsline{toc}{chapter}{\listtablename}
\listoftables


\cleardoublepage
\phantomsection \label{listoflstlistings}
\addcontentsline{toc}{chapter}{\lstlistlistingname}
\lstlistoflistings


\cleardoublepage

% Numeración normal de páginas
\pagenumbering{arabic}


% Definimos el encabezado y pie de página
% \fancyhead{}
% \fancyhead[LE,RO]{\thepage}
% \fancyhead[LO]{\rightmark}
% \fancyhead[ER]{\leftmark}


% Capítulos

\include{capitulos/introduccion}
\include{capitulos/estado_arte}
\include{capitulos/fundamentos_tec}
\include{capitulos/metodologia_desarrollo}
\include{capitulos/analisis}
\include{capitulos/planificacion}
\include{capitulos/diseno}
\include{capitulos/implementacion}
%\include{capitulos/solucion}
\include{capitulos/conclusiones}



% Apéndices
\appendix 
\include{capitulos/casos_uso} 
\include{capitulos/apen_encuestas} 
\include{capitulos/apen_manual_usuario} 
\include{capitulos/apen_contenido_dvd} 




% Definimos el encabezado y pie de página
\fancyhead{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[LO,ER]{\rightmark}

% Glosario de términos
%\printglossary
%\cleardoublepage


% Bibliografía
\cleardoublepage
\bibliographystyle{pfc-fic}
\bibliography{biblio}
\addcontentsline{toc}{chapter}{Bibliografía}


%\cleardoublepage
%\listoftodos %% CVR, para mostrar todos los comentarios
%\addcontentsline{toc}{chapter}{List of todos}
%\pdfbookmark[0]{List of todos}{toc}%

\end{document}